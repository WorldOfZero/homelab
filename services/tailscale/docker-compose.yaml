x-logging-config:
  &logging-config
  driver: "json-file"
  options:
    max-size: "1m"
    max-file: "1"
    tag: "{{.Name}}"
    
services:
  tailscale:
    image: tailscale/tailscale:v1.88
    hostname: tailscale-minerva
    environment:
      - TS_AUTHKEY=${TAILSCALE_AUTH_TOKEN}
      - TS_EXTRA_ARGS=--advertise-tags=tag:container
      - TS_STATE_DIR=/var/lib/tailscale
      - TS_USERSPACE=false
      - TS_ENABLE_METRICS=true
    volumes:
      - '/mnt/Vault/Configuration/tailscale/state:/var/lib/tailscale'
    devices:
      - /dev/net/tun:/dev/net/tun
    cap_add:
      - net_admin
    restart: unless-stopped
    healthcheck:
      test: curl --connect-timeout 15 --silent --show-error --fail http://localhost:9002/healthz
      interval: 1m00s
      timeout: 15s
      retries: 3
      start_period: 1m00s
    logging: *logging-config